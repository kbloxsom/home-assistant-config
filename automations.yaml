---
- id: '1632413597243'
  alias: Samba Backup Sensor Restore
  description: Restore Samba Backup sensor state on Home Assistant startup
  trigger:
    - platform: homeassistant
      event: start
  condition: []
  action:
    - service: hassio.addon_stdin
      data:
        addon: 15d21743_samba_backup
        input: restore sensor
  mode: single

- id: '1634858908611'
  alias: Turn On Lights at Sunset
  description: Turn on yard lights 5 minutes before sunset
  trigger:
    - platform: sun
      event: sunset
      offset: -00:05:00
  condition: []
  action:
    - service: light.turn_on
      target:
        entity_id: group.yard_lights
  mode: single

- id: '1644045610314'
  alias: Front Door Motion - Turn On Yard Lights
  description: Turn on all yard lights when front door motion is detected after dark
  trigger:
    - platform: event
      event_type: front_door_motion
  condition:
    - condition: or
      conditions:
        - condition: sun
          after: sunset
          after_offset: -00:30:00
        - condition: sun
          before: sunrise
          before_offset: 00:15:00
    - condition: time
      after: '22:30:00'
  action:
    - service: light.turn_on
      target:
        entity_id: group.yard_lights
    - delay:
        minutes: 30
    - service: light.turn_off
      target:
        entity_id: group.yard_lights
  mode: single

- id: '1634859253974'
  alias: Turn Off Yard Lights at Night
  description: Turn off yard lights at 11:55 PM
  trigger:
    - platform: time
      at: '23:55:00'
  condition: []
  action:
    - service: light.turn_off
      target:
        entity_id: group.yard_lights
  mode: single

- id: '1635263376971'
  alias: Garage Lights On Motion
  description: Turn on garage lights and bench switch when motion or garage door opening is detected
  trigger:
    - platform: state
      entity_id: binary_sensor.1000aea811_302a019a04b0556c69
      from: 'off'
      to: 'on'
    - platform: state
      entity_id: binary_sensor.1000aea811_14
      from: 'off'
      to: 'on'
    - platform: state
      entity_id: cover.mayfield
      from: closed
      to: opening
  condition: []
  action:
    - service: light.turn_on
      target:
        entity_id: light.garage_lights_2
    - service: switch.turn_on
      target:
        entity_id: switch.garage_bench_switch_relay
    - delay:
        seconds: 10
  mode: single

- id: '1635264539441'
  alias: Garage Lights Off on No Motion
  description: Turn off garage lights after 20 minutes of no motion if garage is unoccupied
  trigger:
    - platform: state
      entity_id: binary_sensor.1000aea811_14
      from: 'on'
      to: 'off'
      for:
        minutes: 20
  condition:
    - condition: state
      entity_id: input_boolean.garage_occupied
      state: 'off'
  action:
    - service: light.turn_off
      target:
        entity_id: light.garage_lights_2
    - service: switch.turn_off
      target:
        entity_id: switch.garage_bench_switch_relay
  mode: single

- id: '1636662663421'
  alias: Mailbox Opened
  description: Notify when mailbox is opened
  trigger:
    - platform: event
      event_type: sonoff.remote
      event_data:
        name: Mailbox
  condition: []
  action:
    - service: notify.mobile_app_bloxsom
      data:
        message: "Mailbox has been opened!"
    - delay:
        minutes: 5
  mode: single

- id: '1635263376973'
  alias: AS Update Last Motion
  description: Update last motion sensor history
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.1000aea811_0
        - binary_sensor.1000aea811_1
        - binary_sensor.1000aea811_2
        - binary_sensor.1000aea811_3
        - binary_sensor.1000aea811_4
        - binary_sensor.1000aea811_5
        - binary_sensor.1000aea811_6
        - binary_sensor.1000aea811_7
        - binary_sensor.1000aea811_8
        - binary_sensor.1000aea811_9
        - binary_sensor.1000aea811_10
        - binary_sensor.1000aea811_11
        - binary_sensor.1000aea811_12
        - binary_sensor.1000aea811_13
        - binary_sensor.1000aea811_14
      to: 'on'
  action:
    - service: variable.update_sensor
      data:
        attributes:
          history_1: "{{ states('sensor.last_motion') }}"
          history_2: "{{ state_attr('sensor.last_motion', 'history_1') }}"
          history_3: "{{ state_attr('sensor.last_motion', 'history_2') }}"
          history_4: "{{ state_attr('sensor.last_motion', 'history_3') }}"
          history_5: "{{ state_attr('sensor.last_motion', 'history_4') }}"
          history_6: "{{ state_attr('sensor.last_motion', 'history_5') }}"
          history_7: "{{ state_attr('sensor.last_motion', 'history_6') }}"
          history_8: "{{ state_attr('sensor.last_motion', 'history_7') }}"
          history_9: "{{ state_attr('sensor.last_motion', 'history_8') }}"
          history_10: "{{ state_attr('sensor.last_motion', 'history_9') }}"
        replace_attributes: true
      target:
        entity_id: sensor.last_motion
    - service: variable.update_sensor
      data_template:
        entity_id: sensor.last_motion
        value: "{{ trigger.to_state.attributes.friendly_name }} : {{ as_timestamp(trigger.to_state.last_changed) | timestamp_custom('%x, %X') }}"
  mode: single
